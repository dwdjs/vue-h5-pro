# webpack é…ç½®ä¼˜åŒ–

## code splitting

æ¥æº https://github.com/frontend9/fe9-library/issues/242ï¼Œè®²è§£å¾ˆé€å½»

### ä¸ºä»€ä¹ˆè¦åš code splitting

- å‡å°‘å•ä¸€èµ„æºçš„å¤§å°ï¼ˆå¤§å°å’Œæ•°ç›®ä¹‹é—´æœ‰ä¸€ä¸ªæƒè¡¡ï¼‰
- å¯¹äºå¤šé¡µæˆ–è€…åŠ¨æ€åŠ è½½ä¸‹çš„å¤šè·¯ç”±æƒ…å†µä¸‹å‡å°å†—ä½™çš„å†…å®¹ï¼ˆåŒæ ·çš„æ¨¡å—åœ¨ä¸åŒé€»è¾‘å¯èƒ½ä¼šè¢«é‡å¤åŒ…å«ï¼‰
- é€šè¿‡ä¸åŒé¡µé¢ç›´æ¥æ¨¡å—çš„å¤ç”¨æé«˜ç¼“å­˜çš„ä½œç”¨
- å°†é•¿æœŸä¸ä¼šæ”¹å˜çš„å†…å®¹æ‰“åŒ…åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­é¿å…æ–°çš„å‘å¸ƒå¸¦æ¥èµ„æºçš„æ›´æ–°ï¼Œå¯ä»¥æé«˜ç¼“å­˜çš„å‘½ä¸­ç‡

### chunk æ¦‚è¿°

chunk æ˜¯æŒ‡æœ€ç»ˆè¢«æ‰“åŒ…å‡ºæ¥çš„ä»£ç å—ï¼ˆæ„å»ºäº§ç‰©æ¯ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ª chunkï¼‰ï¼Œcode splitting åˆ™æ˜¯æŒ‡å¦‚ä½•ç”Ÿæˆè¿™äº›ä»£ç å—ã€‚åš code splitting æœ‰å¦‚ä¸‹å››ä¸ªæ–¹æ³•ï¼š

- å¤š entryï¼Œå¤š entry ä¸ä»…å¯ä»¥ç”¨æ¥å¤šä¸ªç‹¬ç«‹çš„åº”ç”¨çš„é…ç½®ï¼Œè¿˜å¯ä»¥ç”¨æ¥å®ç°ä¸€ä¸ªåº”ç”¨æ‰“åŒ…æˆä¸ºå¤šä¸ªåŒ…ã€‚
- åŠ¨æ€åŠ è½½ï¼ˆDynamic Importsï¼‰ã€‚
- Prevent Duplicationï¼Œé…ç½® `optimization.splitChunks`ï¼Œä½¿ç”¨ [SplitChunksPlugin](https://webpack.js.org/plugins/split-chunks-plugin/) è¿™ä¸ªæ’ä»¶ã€‚
- é…ç½® optimization.runtimeChunkã€‚

å…¶ä¸­å‰é¢ä¸¤ç§æ˜¯åŸºæœ¬çš„æ–¹æ³•ï¼Œå®ƒä»¬å°† chunk åˆ†ä¸º initial å’Œ async ä¸¤ç§ç±»å‹ã€‚

- initial æ˜¯æŒ‡åˆå§‹åŒ– chunkï¼Œä¸€èˆ¬å°±æ˜¯æ¯ä¸ª entry å¯¹åº”ä¸€ä¸ªã€‚
- async æ˜¯åŠ¨æ€åŠ è½½çš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯é¡¹ç›®é‡Œé¢é€šè¿‡ import() å‡½æ•°æ¥åŠ è½½çš„éƒ¨åˆ†ã€‚

åé¢ä¸¤ä¸ªæ–¹æ³•æ˜¯æŒ‡é€šè¿‡ webpack çš„é…ç½®ï¼Œå¯ä»¥æŒ‰ç…§ä¸€å®šçš„è§„èŒƒæ¥åˆ’åˆ† chunkï¼Œä¹Ÿå°±æ˜¯ä»ä¸Šé¢ä¸¤ç§åŸºæœ¬çš„ chunk ä¸­æå–å‡ºæ›´å¤š chunkï¼Œè¾¾åˆ°æé«˜ç¼“å­˜å‘½ä¸­ç‡ï¼Œé™ä½å†—ä½™ä»£ç ç­‰ä¼˜åŒ–ï¼Œä»è€Œå®ç°æœŸæœ›çš„ä¼˜åŒ–ç›®çš„ã€‚

ä¸€å¥è¯æ¥è¯´ï¼šwebpack ä¼š ä»¥ entry å’Œ import ä¸ºåˆ‡å‰²ç‚¹åˆ’åˆ†æ–‡ä»¶ï¼Œç„¶åæŒ‰ç…§ `optimization.splitChunks` é…ç½®æ¥åšå…¬å…± chunk çš„æå–ã€‚

## é»˜è®¤çš„ vue-cli3 é…ç½®

é»˜è®¤çš„é…ç½®å¦‚ä¸‹ï¼Œå¯¹åˆå§‹çš„ç®€å•é¡¹ç›®è¶³å¤Ÿç”¨äº†

```js
// vue-cli3 é»˜è®¤çš„ splitChunks é…ç½®
// å•é¡µé¢é¡¹ç›®å˜å¤§ä¹‹åï¼Œæå–æ–‡ä»¶ä¹Ÿå˜çš„å¾ˆå¤§ï¼Œéœ€è¦ç»§ç»­ä¼˜åŒ–æ‹†åˆ†
splitChunks: {
  cacheGroups: {
    vendors: {
      name: 'chunk-vendors',
      test: /[\\\/]node_modules[\\\/]/,
      priority: -10,
      chunks: 'initial'
    },
    common: {
      name: 'chunk-common',
      minChunks: 2,
      priority: -20,
      chunks: 'initial',
      reuseExistingChunk: true
    }
  }
}
```

ä½†é¡¹ç›®å˜å¤§ä¹‹åï¼Œ`chunk-vendors.xxx.js`ã€`app.xxx.js` ä¼šè¾¾åˆ° 300K+(gzip 100K+)ï¼Œå°±éœ€è¦ç»§ç»­ä¼˜åŒ–

## webpack é…ç½®

å…ˆåˆ†æ¸…ä¸¤ä¸ªæ¦‚å¿µï¼Œchunk å’Œ moduleï¼Œå¯ä»¥è¿™æ ·ç®€å•çš„ç†è§£

- æˆ‘ä»¬é¡¹ç›®ä¸­æ¯ä¸€ä¸ªå¼•å…¥çš„èµ„æºï¼Œéƒ½å¯ä»¥ç†è§£ä¸ºä¸€ä¸ª module
- è€Œ webpack æ‰“åŒ…è¾“å‡ºçš„æ¯ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ï¼Œéƒ½æ˜¯ä¸€ä¸ª chunkã€‚ä¸€ä¸ª chunk å¯ä»¥åŒ…å«å¤šä¸ª module

åœ¨ä¼˜åŒ–ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸‹ webpack çš„ `splitChunks` é…ç½®é¡¹[å®˜æ–¹æ–‡æ¡£](https://webpack.js.org/plugins/split-chunks-plugin/)ï¼Œå…¶é»˜è®¤é…ç½®å¦‚ä¸‹ï¼š

- chunk æ˜¯è¢«å¤ç”¨çš„ï¼Œæˆ–è€…æ˜¯åœ¨ node_modules ä¸‹é¢çš„
- chunk çš„å¤§å°å¤§äº 30kbï¼ˆå‹ç¼©å’Œ gzip ä¹‹å‰ï¼‰
- æ¯ä¸ªé¡µé¢çš„ chunk æ•°ä¸å¤§äº 5 ä¸ª
- åˆå§‹åŒ–é¡µé¢çš„ chunk æ•°ä¸å¤§äº 3 ä¸ª

ä¸ºäº†æ»¡è¶³åé¢ä¸¤ä¸ªæ¡ä»¶ï¼Œwebpackæœ‰å¯èƒ½å—é™äºåŒ…çš„æœ€å¤§æ•°é‡å€¼ï¼Œç”Ÿæˆçš„ä»£ç ä½“ç§¯å¾€ä¸Šå¢åŠ ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆé¡¹ç›®å¤§äº†ä¹‹åï¼Œè¾“å‡ºçš„ chunk ä¼šé‚£ä¹ˆå¤§äº†ã€‚

```js
// webpack é»˜è®¤çš„ splitChunks é…ç½®
module.exports = {
  // ...
  optimization: {
    splitChunks: {
      chunks: 'async',
      minSize: 30000, // byte, 30kb
      maxSize: 0,
      minChunks: 1,
      maxAsyncRequests: 5,
      maxInitialRequests: 3,
      automaticNameDelimiter: '~',
      automaticNameMaxLength: 30,
      name: true,
      cacheGroups: {
        vendors: {
          test: /[\\/]node_modules[\\/]/, // ç¬¦åˆæ¡ä»¶çš„å°±ä¼šè¢«æå–ï¼Œä¸å†™é»˜è®¤é€‰æ‹©æ‰€æœ‰æ¨¡å—
          priority: -10, // ä¼˜å…ˆçº§ï¼Œå½“åŒä¸€ä¸ªæ¨¡å—åŒæ—¶åŒ…å«åœ¨ä¸åŒcacheGroupä¸­ï¼Œè¯¥æ¨¡å—å°†è¢«åˆ’åˆ†åˆ°ä¼˜å…ˆçº§é«˜çš„ç»„ä¸­
        },
        default: { // é»˜è®¤ç¼“å­˜ç»„çš„é…ç½®
          minChunks: 2,
          priority: -20,
          reuseExistingChunk: true, // å¦‚æœè¯¥chunkåŒ…å«çš„moduleséƒ½å·²ç»åœ¨å¦ä¸€ä¸ªè¢«åˆ†å‰²çš„chunkä¸­å­˜åœ¨ï¼Œé‚£ä¹ˆç›´æ¥å¼•ç”¨å·²å­˜åœ¨çš„chunkï¼Œä¸ä¼šå†é‡æ–°äº§ç”Ÿä¸€ä¸ª
        },
        common: { // è¿™ä¸ªä¸æ˜¯é»˜è®¤çš„ï¼Œæ˜¯ yutingzhao1991 åŠ çš„
          filename: '[name].bundle.js', // chunks ä¸º initial æ—¶æœ‰æ•ˆã€‚åœ¨ manifest ä¸­æœ€åä¼šæ˜¯ '[name].js': [name].bundle.js[TODO: è¿™ä¸ªï¼Ÿ]ã€‚webpack é»˜è®¤å€¼æ˜¯ [name].jsã€‚
          name: 'common', // å’Œ filename çš„ä½œç”¨ç±»ä¼¼
          chunks: 'initial',
          minChunks: 1,
          enforce: true, // æ— è§† maxInitialRequest maxAsyncRequests maxSize minSize é…ç½®ï¼Œéƒ½ä¼šç”Ÿæˆè¿™ä¸ª chunk
        },
      },
    },
  },
}
```

`splitChunks` å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š

- chunks: è¡¨ç¤ºæå– chunks çš„æ—¶å€™ä»å“ªé‡Œæå–
  - async: (é»˜è®¤)è¡¨ç¤ºå¯¹åŠ¨æ€ï¼ˆå¼‚æ­¥ï¼‰å¯¼å…¥çš„æ¨¡å—è¿›è¡Œåˆ†å‰²æå–
  - all: ä¸ç®¡æ˜¯ä¸æ˜¯ async çš„éƒ½å¯èƒ½è¢«æŠ½å‡º chunk
  - initial: ä»é async é‡Œé¢æå–
  - function: é€šè¿‡å‡½æ•°ä¹Ÿå¯ä»¥æ§åˆ¶ï¼Œå¦‚ `chunk: function (chunk) { return chunk.name === 'vuex' }`
  - å¯ä»¥å°†æ­¤é…ç½®ä¸`HtmlWebpackPlugin`ç»“åˆä½¿ç”¨ï¼Œå°†æŠ½å–å—ç›´æ¥æ³¨å…¥ html
- minSize: byteå•ä½å­—èŠ‚, é»˜è®¤ 30kbã€‚å€¼è¶Šå¤§é‚£ä¹ˆå•ä¸ªæ–‡ä»¶è¶Šå¤§ï¼Œchunk æ•°å°±ä¼šå˜å°‘ï¼ˆé’ˆå¯¹äºæå–å…¬å…± chunk çš„æ—¶å€™ï¼Œä¸ç®¡å†å¤§ä¹Ÿä¸ä¼šæŠŠåŠ¨æ€åŠ è½½çš„æ¨¡å—åˆå¹¶åˆ°åˆå§‹åŒ–æ¨¡å—ä¸­ï¼‰å½“è¿™ä¸ªå€¼å¾ˆå¤§çš„æ—¶å€™å°±ä¸ä¼šåšå…¬å…±éƒ¨åˆ†çš„æŠ½å–äº†
- maxSize: æ–‡ä»¶çš„æœ€å¤§å°ºå¯¸ï¼Œé»˜è®¤ä¸º 0ï¼Œå³ä¸é™åˆ¶ã€‚ä¼˜å…ˆçº§ï¼šmaxInitialRequest/maxAsyncRequests < maxSize < minSizeï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªå¦‚æœé…ç½®äº†ï¼Œæ–‡ä»¶å¤§äº†å°±ä¼šè¢«æ‹†å¼€ã€‚
- minChunks: è¢«æå–çš„ä¸€ä¸ªæ¨¡å—è‡³å°‘éœ€è¦åœ¨å‡ ä¸ª chunk ä¸­è¢«å¼•ç”¨ï¼Œè¿™ä¸ªå€¼è¶Šå¤§ï¼ŒæŠ½å–å‡ºæ¥çš„æ–‡ä»¶å°±è¶Šå°ã€‚é»˜è®¤ä¸º 1ï¼Œå³ä¸éœ€è¦å¤šæ¬¡å¼•ç”¨ä¹Ÿå¯ä»¥è¢«åˆ†å‰²ï¼Œä¿è¯ä»£ç å—å¤ç”¨æ€§ï¼‰
- maxAsyncRequests: åœ¨åšä¸€æ¬¡æŒ‰éœ€åŠ è½½çš„æ—¶å€™æœ€å¤šæœ‰å¤šå°‘ä¸ªå¼‚æ­¥è¯·æ±‚ï¼Œä¸º 1 çš„æ—¶å€™å°±ä¸ä¼šæŠ½å–å…¬å…± chunk äº†ï¼Œé»˜è®¤ä¸º 5ï¼›
- maxInitialRequests: é’ˆå¯¹ä¸€ä¸ª entry åšåˆå§‹åŒ–æ¨¡å—åˆ†éš”çš„æ—¶å€™çš„æœ€å¤§æ–‡ä»¶æ•°ï¼Œä¼˜å…ˆçº§é«˜äº cacheGroupï¼Œæ‰€ä»¥ä¸º 1 çš„æ—¶å€™å°±ä¸ä¼šæŠ½å– initial common äº†ï¼Œé»˜è®¤ä¸º 3ï¼›
- automaticNameDelimiter: æ–‡ä»¶ååˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸º `~`ï¼›
- automaticNameMaxLength: å…è®¸ä¸ºç”± `SplitChunksPlugin` ç”Ÿæˆçš„å—åç§°è®¾ç½®æœ€å¤§å­—ç¬¦æ•°ï¼›
- name: chunk çš„åç§°ã€‚é»˜è®¤ trueï¼Œå°†æ ¹æ®å—å’Œç¼“å­˜ç»„å¯†é’¥è‡ªåŠ¨ç”Ÿæˆåç§°ï¼›
- cacheGroups: ç¼“å­˜ç»„ã€‚å¯ä»¥ç»§æ‰¿å’Œ/æˆ–è¦†ç›–ä¸Šé¢çš„é…ç½®ï¼Œå¹¶æä¾›ä»¥ä¸‹ç‹¬æœ‰å‚æ•°é…ç½®ï¼Œå¦‚è¦ç¦ç”¨é»˜è®¤ç¼“å­˜ç»„ï¼Œå°†å…¶è®¾ç½®ä¸º false `cacheGroups: { default: false }`ï¼›
  - test: è¡¨ç¤ºè¦è¿‡æ»¤ modulesï¼Œé»˜è®¤ä¸ºæ‰€æœ‰çš„ modulesï¼Œå¯é…ç½®å†³å®šæ¨¡å—èµ„æºè·¯å¾„æˆ– chunk åå­—ï¼Œå½“åŒ¹é…çš„æ˜¯ chunk åå­—çš„æ—¶å€™ï¼Œå…¶é‡Œé¢çš„æ‰€æœ‰ modules éƒ½ä¼šé€‰ä¸­ï¼›
  - priorityï¼šè¡¨ç¤ºæŠ½å–æƒé‡ï¼Œæ•°å­—è¶Šå¤§è¡¨ç¤ºä¼˜å…ˆçº§è¶Šé«˜(é»˜è®¤ä¸ºè´Ÿ)ã€‚å› ä¸ºä¸€ä¸ª module å¯èƒ½ä¼šæ»¡è¶³å¤šä¸ª cacheGroups çš„æ¡ä»¶ï¼Œé‚£ä¹ˆæŠ½å–åˆ°å“ªä¸ªå°±ç”±æƒé‡æœ€é«˜çš„è¯´äº†ç®—ï¼›
  - reuseExistingChunkï¼šè¡¨ç¤ºæ˜¯å¦ä½¿ç”¨å·²æœ‰çš„ chunkï¼Œå¦‚æœä¸º true åˆ™è¡¨ç¤ºå¦‚æœå½“å‰çš„ chunk åŒ…å«çš„æ¨¡å—å·²ç»è¢«æŠ½å–å‡ºå»äº†ï¼Œé‚£ä¹ˆå°†ä¸ä¼šé‡æ–°ç”Ÿæˆæ–°çš„ï¼›
  - filename: å…è®¸åœ¨å½“ä¸”ä»…å½“å®ƒæ˜¯åˆå§‹å—æ—¶è¦†ç›–æ–‡ä»¶åï¼›
  - enforce: å°†å¿½ç•¥ xxxSize, xxxRequestsé€‰æ‹©ï¼Œåªä¸ºè¿™ä¸ªç¼“å­˜ç»„åˆ›å»ºå—ï¼›

å¯¹æ­¤ï¼Œå¯ä»¥å¯¹æ¯” vue-cli3 çš„é»˜è®¤é…ç½®ç†è§£å„å‚æ•°é…ç½®

### æ€§èƒ½ä¼˜åŒ–

æ¥è‡ª yutingzhao1991

**ä¼˜åŒ–æ€è·¯ï¼š**

- æ€»ä½“ç›®çš„æ˜¯ä¸ºäº†é™ä½ï¼ˆæœ€å°å¯ç”¨ï¼‰èµ„æºåŠ è½½æ—¶é—´
- æé«˜ç¼“å­˜å‘½ä¸­ç‡
- é™ä½èµ„æºå°ºå¯¸å¤§å°
- é¢„åŠ è½½

**splitChunk é…ç½®ç­–ç•¥**

- è¯·æ±‚æ•°å’Œå¤§å°ä¹‹é—´çš„æƒè¡¡ã€‚HTTP2 æ™®åŠåå€¾å‘äºå¤šæ–‡ä»¶ï¼Œå•ä¸ªæ–‡ä»¶æ›´å°ï¼Œæé«˜ç¼“å­˜å‘½ä¸­ç‡å’Œæ€»ä½“èµ„æºå¤§å°ã€‚

**ä¼˜åŒ–å»ºè®®**

- initial çš„æ¨¡å—æŒ‰ç…§é¡¹ç›®å®é™…æƒ…å†µæ‰‹åŠ¨åˆ’åˆ†ä¸ºå‡ ä¸ªéƒ¨åˆ†ï¼Œå¯¹äºå•é¡µåº”ç”¨æ¥è¯´é€šå¸¸å°±æ˜¯æŒ‡æŠŠ node_modules é‡Œé¢çš„å†…å®¹å•ç‹¬æŠ½å–ï¼Œæ¯”å¦‚å¯ä»¥æŠŠ react ç›¸å…³æŠ½å–å‡ºæ¥ä½œä¸ºä¸€ä¸ª chunkï¼Œç„¶åå…¶ä»–å·¥å…·æŠ½å–å‡ºæ¥ä½œä¸ºä¸€ä¸ª chunkã€‚è¿™æ ·å›ºå®šçš„æ¨¡å¼æ›´å®¹æ˜“ä¿æŒæ„å»ºäº§ç‰©åœ¨å¤šæ¬¡å‘å¸ƒä¹‹é—´ä¸æ”¹å˜ã€‚
- async çš„æ¨¡å—è®¾å®šä¸€ä¸ªåˆé€‚çš„ minSize å³å¯ï¼Œä½¿å¾—æ–‡ä»¶å¤§å°å’Œä¸ªæ•°æœ€ä¼˜ã€‚ä¸ªäººæ„Ÿè§‰ä¹Ÿä¸éœ€è¦å•ç‹¬æŠŠ node_modules ä¸­çš„æ–‡ä»¶æå–å‡ºæ¥ï¼Œè¿™æ ·å¯èƒ½ä¼šå¯¼è‡´æ–‡ä»¶å¤ªå¤šã€‚
- å¯¹äºå¤š entry çš„åº”ç”¨å¯ä»¥å†æŠ½å–å‡ºå…¬å…±çš„æ–¹æ³•ï¼Œé€šè¿‡ minChunks æ¥è®¾å®šï¼Œæ¯”å¦‚è¶…è¿‡ä¸¤ä¸ªå¼•ç”¨å°±æŠ½å–åˆ° commons ä¸­ã€‚

**å…³äº external**

ä¸€äº›ç‰¹åˆ«å¤§çš„åº“å¯ä»¥åŠ ä¸Š externalï¼Œæ¯”å¦‚ data-setï¼Œg2ï¼Œelement-ui è¿™äº›

**å…³äºruntimeChunk**

è¿™ä¸ªå¯ä»¥ä¸è®¾ç½®

## é…ç½®å®æˆ˜

### å¦‚ä½•ä¼˜åŒ–

å‰é¢è¢«æ€»ç»“çš„éƒ½å·®ä¸å¤šäº†ï¼Œæˆ‘ä»¬è€ƒè™‘ä¸‹æˆ‘ä»¬çš„åœºæ™¯ç°å†µå’ŒæœŸæœ›

å¯¹äº vue-cli3 é»˜è®¤é…ç½®å¹¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œé¡¹ç›®å¤§äº†ï¼Œè¾“å‡ºæ–‡ä»¶å°±å˜å¾—å¾ˆå¤§ï¼Œæˆ‘ä»¬éœ€è¦ç»§ç»­æ‹†åˆ†ï¼Œè€Œæˆ‘ä»¬çš„æ¨¡å—ç±»å‹å¤§ä½“å¦‚ä¸‹

| ç±»å‹ | å¤ç”¨ç‡ | æ›´æ–°é¢‘ç‡ | ä¾‹å­ğŸŒ° |
|:=====|:=====|:========|:======|
| ç¬¬ä¸‰æ–¹åº“ | é«˜ | ä½ | vue, vue-router, vuex, axios ç­‰ |
| utilåº“, UIåº“ | é«˜ | ä¸­ | @dwdjs/utils, vant |
| ä¸šåŠ¡æ¨¡å— | ä½ | é«˜ | ä¸šåŠ¡é€»è¾‘ä»£ç ï¼Œå„ç§view |

æ‹†åˆ†å¦‚ä¸‹

- æå–ç¬¬ä¸‰æ–¹ä¸ºç‹¬ç«‹åŒ…ï¼Œå¦‚ vue, vue-router, vuex, axios ç­‰
  - ä¸ä»…èƒ½è·¨ç«¯å¤ç”¨ cdnï¼Œè¿˜èƒ½å……åˆ†åˆ©ç”¨æµè§ˆå™¨ç¼“å­˜
  - å¯ä½¿ç”¨ webpack dll æ–¹æ¡ˆå®ç°ï¼Œè¿˜èƒ½æå‡æ„å»ºé€Ÿåº¦
- æå–é¡¹ç›®å…¬å…±åº“ï¼Œå¦‚ utils, api, tongji ç­‰
  - æ£€æŸ¥æŒ‰éœ€å¼•å…¥ Code Splitting æ˜¯å¦èµ·åˆ°æ•ˆæœï¼Œæ¯”å¦‚ @dwdjs/utils å°±å…¨é‡å¼•å…¥äº†ï¼Œå¹¶æœªæŒ‰éœ€åŠ è½½
- ä¸šåŠ¡å…¬ç”¨ä»£ç ï¼ŒæŒ‰å¼•ç”¨æ¬¡æ•°åˆ†å‰²å³å¯
- é¡µé¢é€»è¾‘ï¼ŒæŒ‰éœ€åŠ¨æ€åŠ è½½æ¥å£
  - å¦‚æœæ–‡ä»¶è¿‡å°ï¼Œæ˜¯å¦å¯ä»¥åˆå¹¶ï¼Ÿ
- å¯ç”¨ http2ï¼Œå……åˆ†åˆ©ç”¨å¤šè·¯å¤ç”¨åŠ è½½èµ„æº
- åˆ©ç”¨é¢„åŠ è½½ã€é¢„è§£æ
- ä½¿ç”¨ Service workerï¼Ÿä¸æ”¯æŒ http2ï¼Œå¤šè·¯å¤ç”¨è¿˜æœ‰æ•ˆå—ï¼Œé€Ÿåº¦æ˜¯å¦å¿«ï¼Ÿ
- æŠŠ manifest ä»£ç ï¼ˆè¿™ä¸ªæ–‡ä»¶å¾ˆå°ï¼Œä¸å€¼å¾—ä¸€ä¸ª http è¯·æ±‚ï¼‰ inline åˆ° html ä¸­

æœ‰äº†æ–¹å‘ï¼Œå‰©ä¸‹çš„å°±æ˜¯äº§å‡ºé…ç½®äº†ï¼Œè¿™ä¸ªè¿˜éœ€è¦ç»†èŠ‚è°ƒè¯•

### ç¤ºä¾‹

vue-cli3 é…ç½®

```js
chainWebpack: config => {
  config.optimization.splitChunks({
    chunks: 'all',
    minSize: 60000, // byte, 30kb
    maxSize: 0,
    minChunks: 1,
    maxAsyncRequests: 5,
    maxInitialRequests: 3,
    automaticNameDelimiter: '~',
    automaticNameMaxLength: 30,
    cacheGroups: {
      // æŠ½å–ç¬¬ä¸‰æ–¹æ¨¡å—
      libs: {
        name: `chunk-lib`,
        test: /[\\/]node_modules[\\/](vue|vuex|vue-router|axios|register-service-worker)[\\/]/,
        priority: 0,
        chunks: 'initial',
      },
      vendors: {
        name: `chunk-vendors`,
        test: /[\\/]node_modules[\\/]/,
        priority: -10,
        chunks: 'initial',
      },
      common: {
        name: `chunk-common`,
        minChunks: 2,
        priority: -20,
        chunks: 'initial',
        reuseExistingChunk: true,
      },
    },
  })
}
```

## åŠ è½½ SourceMap

å¯ä»¥å‚çœ‹

- http://www.xbhub.com/wiki/webpack/3%E5%AE%9E%E6%88%98/3-21%E5%8A%A0%E8%BD%BDSourceMap.html

å‚è€ƒï¼š

- [å®˜æ–¹æ–‡æ¡£](https://webpack.js.org/plugins/split-chunks-plugin/)
- [webpack code splitting è§£æ](https://github.com/frontend9/fe9-library/issues/242)
- [webpackæºç å­¦ä¹ ç³»åˆ—ä¹‹äºŒï¼šcode-splittingï¼ˆä»£ç åˆ‡å‰²ï¼‰](https://github.com/youngwind/blog/issues/100)
- [webpack 4: import() and CommonJs](https://medium.com/webpack/webpack-4-import-and-commonjs-d619d626b655)
- [webpackä¹‹moduleã€chunkå’Œç¼“å­˜æœºåˆ¶](https://fatshen3.cn/2018/03/02/webpack-module-and-chunk-and-chunkhash/)
